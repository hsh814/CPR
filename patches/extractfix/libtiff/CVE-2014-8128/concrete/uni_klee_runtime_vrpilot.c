#include "uni_klee_runtime.h"
#include <stdlib.h>
#include <stdio.h>

int uni_klee_patch_id;

void klee_select_patch(int *patch_id) {
  *patch_id = atoi(getenv("DAFL_PATCH_ID"));
}

void uni_klee_add_patch(int *patch_results, int patch_id, int result) {
  patch_results[patch_id] = result;
}

int uni_klee_choice(int *patch_results, int patch_id) {
  return patch_results[patch_id];
}

// UNI_KLEE_START
int __cpr_choice(char* lid, char* typestr,
                     long long* rvals, char** rvals_ids, int rvals_size,
                     int** lvals, char** lvals_ids, int lvals_size){
  // int patch_results[4096];
  int result;
  long long nrows = rvals[0];
  long long two_five_six = rvals[1];
  long long sizeof_rows = rvals[2];
  long long sizeof_rows_0 = rvals[3];
  long long constant_a;
  int patch_results[262];
  // Patch buggy # 0
  result = (1);
  uni_klee_add_patch(patch_results, 0, result);
  // Patch 1
  result = (nrows < (sizeof_rows / sizeof_rows_0));
  uni_klee_add_patch(patch_results, 1, result);
  // Patch 2
  result = (nrows < two_five_six);
  uni_klee_add_patch(patch_results, 2, result);  
  // Patch correct # 261
  // result = (x < y);
  // uni_klee_add_patch(patch_results, 261, result);
  klee_select_patch(&uni_klee_patch_id);
  return uni_klee_choice(patch_results, uni_klee_patch_id);
}
// UNI_KLEE_END

int __cpr_output(char* id, char* typestr, int value){
  return value;
}
